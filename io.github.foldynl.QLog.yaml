app-id: io.github.foldynl.QLog
runtime: org.kde.Platform
runtime-version: '6.8'
sdk: org.kde.Sdk
base: io.qt.qtwebengine.BaseApp
base-version: '6.8'
command: qlog
rename-desktop-file: qlog.desktop
rename-icon: qlog
finish-args:
  - --device=all
  - --share=network
  - --share=ipc
  - --socket=pulseaudio
  - --socket=x11
  - --own-name=org.freedesktop.secrets
  - --env=QTWEBENGINEPROCESS_PATH=/app/bin/QtWebEngineProcess
  - --filesystem=home
cleanup-commands:
  - /app/cleanup-BaseApp.sh

modules:
  - name: hamlib
    sources:
      - type: archive
        url: https://github.com/Hamlib/Hamlib/releases/download/4.6/hamlib-4.6.tar.gz
        sha256: 6f873579bc4e0ef4e540313ec2acd4f198b5510d7dd9397a4ae68fe8ff20d167
        x-checker-data:
          type: anitya
          project-id: 1292
          url-template: https://github.com/Hamlib/Hamlib/releases/download/$version/hamlib-$version.tar.gz

  - name: dbus-run-session
    buildsystem: cmake
    cleanup: ["*"]
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/dbus/dbus/-/archive/dbus-1.16.0/dbus-dbus-1.16.0.tar.gz
        sha256: d2ca9d958c830e762ba70aea8e6b5c29fa7b58d0fee8ddd9bb5a00f35106ab57
        x-checker-data:
          type: anitya
          project-id: 5356
          url-template: https://gitlab.freedesktop.org/dbus/dbus/-/archive/dbus-$version/dbus-dbus-$version.tar.gz

  - name: libsecret
    buildsystem: meson
    config-opts:
      - -Dcrypto=disabled
      - -Dgtk_doc=false
      - -Dintrospection=false
      - -Dmanpage=false
      - -Dvapi=false
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/libsecret/-/archive/0.21.5/libsecret-0.21.5.tar.gz
        sha256: 7a31edc025352ef2da3acdb75a74eccd322dea8e60929318724b7a0f45bf5c28
        x-checker-data:
          type: anitya
          project-id: 13150
          url-template: https://gitlab.gnome.org/GNOME/libsecret/-/archive/$version/libsecret-$version.tar.gz

  - name: qtkeychain
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/frankosterfeld/qtkeychain/archive/refs/tags/0.14.3.tar.gz
        sha256: a22c708f351431d8736a0ac5c562414f2b7bb919a6292cbca1ff7ac0849cb0a7
        x-checker-data:
          type: anitya
          project-id: 4138
          url-template: https://github.com/frankosterfeld/qtkeychain/archive/refs/tags/$version.tar.gz
    config-opts:
      - -DBUILD_WITH_QT6=ON

  - name: wxwidgets
    buildsystem: cmake-ninja
    config-opts:
      - -DwxUSE_OPENGL=No
      - -DwxUSE_HTML=Yes
      - -DwxUSE_STREAMS=Yes
      - -DwxUSE_WXHTML_HELP=Yes
      - -DCMAKE_BUILD_TYPE=Release
      - -DwxUSE_UNICODE=Yes
    cleanup:
      - /lib/wx
      - /bin/wx-config
      - /bin/wxrc
      - /bin/wxrc-3.2
      - /share/bakefile
      - /include
      - /lib/cmake
    sources:
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.2.6/wxWidgets-3.2.6.tar.bz2
        sha256: 939e5b77ddc5b6092d1d7d29491fe67010a2433cf9b9c0d841ee4d04acb9dce7
        x-checker-data:
          type: anitya
          project-id: 5150
          url-template: https://github.com/wxWidgets/wxWidgets/releases/download/v$version/wxWidgets-$version.tar.bz2

  - name: tqsl
    buildsystem: cmake-ninja
    config-opts:
      - -DTQSL_FLATPAK=Yes
      - -DCMAKE_BUILD_TYPE=Release
    cleanup:
      - /include
      - /share/man
    sources:
      - type: git
        url: https://git.code.sf.net/p/trustedqsl/tqsl
        tag: v2.7.5
        commit: 5d7dbba8de36f72760f0f4783a0bfabbe768db5e
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

    post-install:
      - rm /app/share/metainfo/org.arrl.trustedqsl.metainfo.xml /app/share/app-info/icons/flatpak/*/org.arrl.trustedqsl.png
      - for i in 16 32 48 64 128;do mv /app/share/icons/hicolor/${i}x${i}/apps/org.arrl.trustedqsl.png
        /app/share/icons/hicolor/${i}x${i}/apps/io.github.foldynl.QLog.trustedqsl.png;done
      - mv /app/share/applications/org.arrl.trustedqsl.desktop /app/share/applications/io.github.foldynl.QLog.trustedqsl.desktop
      - desktop-file-edit --set-key="Name" --set-value="TQSL (QLog)" /app/share/applications/io.github.foldynl.QLog.trustedqsl.desktop
      - desktop-file-edit --set-key="Icon" --set-value="io.github.foldynl.QLog.trustedqsl"
        /app/share/applications/io.github.foldynl.QLog.trustedqsl.desktop

  - name: qlog
    buildsystem: qmake
    build-options:
      env:
        - QMAKEPATH=/app/
    config-opts:
      - QMAKE_LIBS += -L/app/lib
      - QMAKE_INCDIR+=/app/include/QtWebEngine
      - QMAKE_INCDIR+=/app/include/QtWebEngineCore
      - QMAKE_INCDIR+=/app/include/QtWebEngineWidgets
      - DEFINES+=QLOG_FLATPAK
    sources:
      - type: git
        url: https://github.com/foldynl/QLog.git
        tag: v0.41.0
        commit: 67aa3ed2b2571891229c188c34ceab23001d4b6c
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
